<html>
<head>
  <style>
    #map {height: 70%;width:60%}
  </style>

  <script src="http://cdn.leafletjs.com/leaflet-0.4.4/leaflet.js"></script>
  <script src="https://unpkg.com/neo4j-driver"></script>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.4/leaflet.css" />
</head>

  <body>
    <div id="map"></div>

    <script>
        var baseLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png',
        { attribution: 'OpenStreetMap', minZoom: 2, maxZoom: 18});

        var map = new L.Map('map', {center: new L.LatLng(42.341145, -71.057083), zoom: 13, layers: [baseLayer]});
/*
        var marker1 = new L.Marker(new L.LatLng(37.5634399, -122.3222646)).addTo(map);
        marker1.bindPopup('Neo4j HQ');

        var marker2 = new L.Marker(new L.LatLng(37.5669493, -122.3237035)).addTo(map);
        marker2.bindPopup('Philz Coffee');

        var marker3 = new L.Marker(new L.LatLng(37.5622308, -122.3268279)).addTo(map);
        marker3.bindPopup('San Mateo Public Library');

        var polygon = L.polygon([
                           new L.LatLng(37.5634399, -122.3222646),
                           new L.LatLng(37.5622308, -122.3268279),
                           new L.LatLng(37.5669493, -122.3237035)
                        ]).addTo(map);
    */
        var driver = neo4j.driver("bolt+s://4880961c56ecb6059750f38a0db86f46.neo4jsandbox.com:7687", 
                                            neo4j.auth.basic("neo4j", "carrier-pea-swells"));
                                            
var session = driver.session();
session
  .run(`MATCH (s:Store WHERE s.neighborhood = 'Dorchester') return s`)
  .subscribe({
    onNext: function (record) {
      console.log(record.get('s'));

      var xVal = record.get('s').properties.coord.x;
      var yVal = record.get('s').properties.coord.y;
      var name = record.get('s').properties.name
      var neighborhood = record.get('s').properties.neighborhood
      var address = record.get('s').properties.address

      // these are swapped for whatever reason
      var marker = new L.marker([yVal, xVal]);
      marker.addTo(map);
      marker.bindPopup('<p>' + name + '<br />' + neighborhood + '<br />' + address + '</p>');
      // marker.bindPopup(neighborhood);
      // marker.bindPopup(address);

      // console.log(xVal);
      // console.log(yVal);
      // console.log(marker);

      //marker.bindPopup('<b>Address:</b> ' + record.get('address') + '<br>' + '<b>Officers: </b>' + record.get('officers').toString() + '<br><b>Entities:</b> ' + record.get('entities').toString() + '<br><b>Offshore Countries: </b> ' + record.get('jurisdictions').toString());
      //markerLayers.addLayer(marker);
      //heatmap.pushData(record.get('latitude'), record.get('longitude'), record.get('strength')*0.01);



    },/*
    onCompleted: function () {
      var overlayMaps = {'Markers': markerLayers, 'Heatmap': heatmap};
      var controls = L.control.layers(null, overlayMaps, {collapsed: false, autoZIndex: true});
      map = new L.Map('map', {center: new L.LatLng(51.505, -0.09), zoom: 3, layers: [baseLayer]});
      map.addLayer(markerLayers);
      map.addLayer(heatmap);
      controls.addTo(map);
      session.close();
    },
    onError: function (error) {
      console.log(error);
    }*/
  });
    </script>

  </body>
</html>